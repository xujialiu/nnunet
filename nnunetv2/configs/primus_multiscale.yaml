# Primus Multiscale configuration for nnUNet integration
# Architecture: https://arxiv.org/pdf/2503.01835
# Uses multi-scale feature aggregation (similar to ViT-adapter)

model:
  model_path: "nnunetv2.model.primus"
  backbone: "dinov3"
  backbone_size: "large"
  checkpoint_path: ""
  decoder:
    multiscale: true
    embed_dim: 768
    patch_embed_size: 16
    # embed_dim: 256        # Optional: decoder embedding dimension per scale
                            # If not set, uses backbone's embed_dim (1024 for large ViT)
                            # Total decoder input = embed_dim * num_scales
    # patch_embed_size: 16  # Optional: patch size for decoder upsampling
                            # Must be power of 2 (2, 4, 8, 16, 32)
                            # If not set, uses backbone's patch_size (16 for dinov3, 14 for dinov2)
    # interaction_indices: [5, 11, 17, 23]  # Layer indices for feature extraction
                                            # Auto-set based on backbone depth if not specified

lora:
  enabled: false
  r: 8
  lora_alpha: 16
  target_modules: ["qkv"]
  # lora_dropout: 0.05

train:
  initial_lr: 0.001
  weight_decay: 0.00003
  gradient_clip: 12.0
  num_epochs: 500
  num_iterations_per_epoch: 100
  num_val_iterations_per_epoch: 50
